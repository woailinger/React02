"use strict";var __extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},render=ReactDOM.render,Component=React.Component,Util={ajax:function(t,e){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var t=JSON.parse(a.responseText);e&&e(t)}},a.open("GET",t,!0),a.send(null)},ObjToQuery:function(t){var e="";for(var a in t)e+="&"+a+"="+t[a];return"?"+e.slice(1)}},App=function(t){function e(e){t.call(this,e),this.state={section:"list",listData:[],detailData:{},commentData:{list:[]}},this.scrollPos={list:0,detail:0,comment:0}}return __extends(e,t),e.prototype.componentDidMount=function(){var t=this;Util.ajax("data/list.json",function(e){0===e.errno&&t.setState({listData:e.data})})},e.prototype.showDetail=function(t){var e=this;Util.ajax("data/detail.json?id="+t,function(t){0===t.errno&&e.setState({detailData:t.data,section:"detail"})}),window.scrollTo(0,0)},e.prototype.showComment=function(t){var e=this;Util.ajax("data/comment.json?id="+t,function(t){0===t.errno&&e.setState({commentData:t.data,section:"comment"})}),window.scrollTo(0,0)},e.prototype.goBack=function(){switch(this.state.section){case"list":break;case"detail":this.setState({section:"list"}),window.scrollTo(0,this.scrollPos.list),this.scrollPos.list=0;break;case"comment":this.setState({section:"detail"}),window.scrollTo(0,this.scrollPos.detail),this.scrollPos.detail=0}},e.prototype.render=function(){var t=this.state.section;return React.createElement("div",null,React.createElement(Header,{goBack:this.goBack.bind(this)}),React.createElement("section",{id:"list",style:{display:"list"===t?"block":"none"}},React.createElement(List,{data:this.state.listData,showDetail:this.showDetail.bind(this)})),React.createElement("section",{id:"detail",style:{display:"detail"===t?"block":"none"}},React.createElement(Detail,{data:this.state.detailData,showComment:this.showComment.bind(this)})),React.createElement("section",{id:"comment",style:{display:"comment"===t?"block":"none"}},React.createElement(Comment,{data:this.state.commentData})))},e.prototype.componentDidUpdate=function(t,e){this.scrollPos[e.section]=2*window.scrollY,console.log(this.scrollPos,window.scrollY)},e}(Component),Header=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.render=function(){return React.createElement("header",{className:"header"},React.createElement("div",{className:"arrow-container",onClick:this.props.goBack},React.createElement("span",{className:"arrow"},React.createElement("span",{className:"arrow blue"}))),React.createElement("span",{className:"login"},"登陆"),React.createElement("h1",null,"腾讯新闻"))},e}(Component),List=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.chooseNews=function(t){this.props.showDetail(t)},e.prototype.createList=function(){var t=this;return this.props.data.map(function(e,a){return React.createElement("li",{key:a,"data-id":e.id,onClick:t.chooseNews.bind(t,e.id)},React.createElement("img",{src:e.img,alt:""}),React.createElement("div",null,React.createElement("h3",null,e.title),React.createElement("p",null,e.content,React.createElement("span",{className:"list-comment"},"评论：",e.comment))))})},e.prototype.render=function(){return React.createElement("ul",{className:"list-ul"},this.createList())},e}(Component),Detail=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.showComment=function(t){var e=t.currentTarget.getAttribute("data-id");this.props.showComment(e)},e.prototype.render=function(){var t=this.props.data,e={__html:t.content};return React.createElement("div",{className:"detail"},React.createElement("h1",null,t.title),React.createElement("p",{className:"detail-intro"},React.createElement("span",{className:"detail-time"},t.time),React.createElement("span",{className:"detail-comment"},"评论：",t.comment)),React.createElement("img",{src:t.img,alt:""}),React.createElement("p",{className:"detail-content",dangerouslySetInnerHTML:e}),React.createElement("span",{className:"detail-comment-btn",onClick:this.showComment.bind(this)},"查看更多评论"))},e}(Component),Comment=function(t){function e(e){t.call(this,e),this.state={data:e.data}}return __extends(e,t),e.prototype.componentWillReceiveProps=function(t){this.setState({data:t.data})},e.prototype.createCommentList=function(){return this.props.data.list.map(function(t,e){return React.createElement("li",{key:e},React.createElement("h3",null,t.user),React.createElement("p",null,t.content),React.createElement("span",null,t.time))})},e.prototype.commentCommit=function(){var t=this.refs.commentTextarea.value;""===t&&alert("请输入内容再提交"),this.submitData(t)},e.prototype.submitData=function(t){{var e=this,a=new Date,n={user:"白天不懂夜得黑",content:t,time:"刚刚"+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()};"data/addComment.json"+Util.ObjToQuery(n)}Util.ajax("data/addComment.json",function(t){if(0===t.errno){var a=e.state.data;a.list.push(n),e.setState({data:a}),e.refs.commentTextarea.value="",alert("提交成功")}})},e.prototype.render=function(){return React.createElement("div",{className:"comment"},React.createElement("div",{className:"input-container"},React.createElement("textarea",{ref:"commentTextarea",placeholder:"请文明上网，理性发言"}),React.createElement("span",{className:"comment-btn",onClick:this.commentCommit.bind(this)},"提交")),React.createElement("ul",null,this.createCommentList()))},e}(Component);render(React.createElement(App,null),document.getElementById("app"));